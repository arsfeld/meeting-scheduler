{% extends "base.html" %}

{% block title %}{{ application_name }} - {{ page.name|escape }} - Edit{% endblock %}

{% block head %}
    <script type="text/javascript">
    
    var onCellClick = function(node) {
      dojo.toggleClass(node, "clicked");
      dojo.byId("eventReport").innerHTML = "Cell (" + 
        node.parentNode.rowIndex +"," +
        node.cellIndex +") clicked" + dojo.query('.clicked');
      
      if (dojo.hasClass(node, "clicked")) {
        //node.innerHTML = "<img src=\"/static/images/delete.png\">";
        dojo.anim(node, { backgroundColor: "red"}, 1000);
      } else {
        //node.innerHTML = "<img src=\"/static/images/accept.png\">";
        dojo.anim(node, { backgroundColor: "white"}, 1000);
      };
    };
    
    var isSelecting = false;

    var onTableMouseOut = function(node) {
      isSelecting = false;
    }
    
    var onCellMouseOut = function(node) {
      dojo.toggleClass(node, "mousing", false);
    }
    
    var onCellMouseOver = function(node) {
      if (isSelecting) {
        if (!dojo.hasClass(node, "mousing")) {
          dojo.toggleClass(node, "mousing", true);
          onCellClick(node);
        }
      }    
    }
    
    var onCellMouseDown = function(node) {
      isSelecting = !isSelecting;
    }
    
    var onCellMouseUp = function(node) {
    //  isSelecting = false;    
    }
    
    var init = function(){
      var count = 0;
      dojo.query(".hour", "queryWrapper").onclick(function(evt){
        //dojo.byId("eventReport").innerHTML = "Cell (" + 
        //  evt.target.parentNode.rowIndex +"," +
        //  evt.target.cellIndex +") clicked";
        //dojo.style(evt.target, "backgroundColor", "lightblue");
      });
      
    };
    
    var cloneForm = function(){
      var formNode = dojo.byId("form");
      var cloneNode = formNode.cloneNode(true);
      dojo.style(cloneNode, "visibility", "visible");
      dojo.style(cloneNode, "opacity", 0);
      formNode.parentNode.appendChild(cloneNode);
      
      dojo.fadeIn({
        node: cloneNode,
        duration: 1000
      }).play()        
    }
    
    dojo.addOnLoad(init);
    </script>
{% endblock %}
{% block body %}
    <p>Você pertence à gestão {{ gestao }}</p>
    <table id="tableHours" border=0 onmousedown='onCellMouseDown(this);' onmouseup='onCellMouseUp(this);' onmouseout='onTableMouseOut(this);'>
      <caption>Selecion seu horário abaixo:</caption>
      <thead>
        <tr>
          <th></th>
          {% for day in days_of_week %}
          <th scope="col">{{ day }}</th>
          {% endfor %}
        </tr>
      </thead>
      
      <tbody>
        {% for hour in hours %}
        <tr id="{{ hour }}" class="{% cycle odd,even %}">
          <td>{{ hour }}:{% cycle 00,30 %}</td>  
          {% for day in days_of_week %}
          <td id="{{ hour }}{{ day }}" class="cell"  onclick='onCellClick(this);' onmouseover='onCellMouseOver(this);' onmouseout='onCellMouseOut(this);'></td>
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>    
    
    <div id="eventReport">
      <p>Event reporter</p>
    </div>
    
    <button dojotype="dijit.form.Button" onclick='cloneForm();' >
      Clone form
    </button>
    
    <div id="forms">
      <div id="form" class="container">
        Gestão: <input type="text" name="name" id="name" value="Your name"/>
      </div>
    </div>
{% endblock %}
